<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ski-Track - R√©initialisation du mot de passe</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .forgot-password-container {
      max-width: 400px;
      margin: 3rem auto;
      padding: 2rem;
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .forgot-password-container h1 {
      text-align: center;
      color: #1f2937;
      margin-bottom: 1rem;
    }
    
    .info-text {
      color: #6b7280;
      margin-bottom: 1.5rem;
      text-align: center;
      font-size: 0.95rem;
    }
    
    .back-link {
      text-align: center;
      margin-top: 1.5rem;
    }
    
    .back-link a {
      color: #1a56db;
      text-decoration: none;
      font-size: 0.9rem;
    }
    
    .back-link a:hover {
      text-decoration: underline;
    }
    
    .success-message, .error-message {
      padding: 0.75rem;
      border-radius: 0.375rem;
      margin-top: 1rem;
      font-size: 0.875rem;
      display: none;
    }
    
    .success-message {
      background-color: #def7ec;
      color: #0e9f6e;
      border: 1px solid #a7f3d0;
    }
    
    .error-message {
      background-color: #fde8e8;
      color: #e02424;
      border: 1px solid #fca5a5;
    }
  </style>
</head>

<body>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèîÔ∏è</text></svg>">
  
  <header>
    <nav>
      <div class="logo">Ski-Track</div>
      <div class="nav-links">
        <a href="../index.html">Tableau de bord</a>
        <a href="login.html">Connexion</a>
      </div>
    </nav>
  </header>
  
  <main>
    <div class="forgot-password-container">
      <h1>R√©initialisation du mot de passe</h1>
      
      <p class="info-text">
        Entrez votre adresse email pour recevoir un lien de r√©initialisation de votre mot de passe.
      </p>
      
      <form id="forgotPasswordForm">
        <div class="form-group">
          <label for="email">Adresse email</label>
          <input 
            type="email" 
            id="email" 
            required 
            placeholder="votre.email@example.com"
            autocomplete="email"
          >
        </div>
        
        <button type="submit" class="btn" id="submit-btn">
          Envoyer le lien de r√©initialisation
        </button>
        
        <div id="success-message" class="success-message"></div>
        <div id="error-message" class="error-message"></div>
      </form>
      
      <div class="back-link">
        <a href="login.html">‚Üê Retour √† la connexion</a>
      </div>
    </div>
  </main>
  
  <!-- Scripts Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  
  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDcBZrwGTskM7QUvanzLTACEJ_T-55j-DA",
      authDomain: "trail-inspection.firebaseapp.com",
      projectId: "trail-inspection",
      storageBucket: "trail-inspection.firebasestorage.app",
      messagingSenderId: "415995272058",
      appId: "1:415995272058:web:dc476de8ffee052e2ad4c3",
      measurementId: "G-EBLYWBM9YB"
    };
    
    // Initialisation de Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // V√©rifier si l'utilisateur est d√©j√† connect√©
    auth.onAuthStateChanged(function(user) {
      if (user) {
        // Si l'utilisateur est d√©j√† connect√©, rediriger vers le tableau de bord
        window.location.href = '../index.html';
      }
    });
    
    // Gestion du formulaire de r√©initialisation
    document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const submitBtn = document.getElementById('submit-btn');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      
      // R√©initialiser les messages
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      
      // D√©sactiver le bouton pendant l'envoi
      submitBtn.disabled = true;
      submitBtn.textContent = 'Envoi en cours...';
      
      // Envoyer l'email de r√©initialisation
      auth.sendPasswordResetEmail(email, {
        // URL de redirection apr√®s r√©initialisation (optionnel)
        url: window.location.origin + '/pages/login.html',
        handleCodeInApp: false
      })
        .then(() => {
          // Succ√®s
          successMessage.textContent = `Un email de r√©initialisation a √©t√© envoy√© √† ${email}. V√©rifiez votre bo√Æte de r√©ception ET VOS SPAMS.`;
          successMessage.style.display = 'block';
          
          // R√©initialiser le formulaire
          document.getElementById('forgotPasswordForm').reset();
          
          // Optionnel : Rediriger vers la page de connexion apr√®s quelques secondes
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 5000);
        })
        .catch((error) => {
          // Gestion des erreurs
          console.error('Erreur lors de l\'envoi de l\'email:', error);
          
          let errorMsg = '';
          switch(error.code) {
            case 'auth/user-not-found':
              errorMsg = 'Aucun compte n\'est associ√© √† cette adresse email.';
              break;
            case 'auth/invalid-email':
              errorMsg = 'L\'adresse email n\'est pas valide.';
              break;
            case 'auth/too-many-requests':
              errorMsg = 'Trop de tentatives. Veuillez r√©essayer plus tard.';
              break;
            case 'auth/network-request-failed':
              errorMsg = 'Erreur de connexion r√©seau. V√©rifiez votre connexion internet.';
              break;
            default:
              errorMsg = 'Une erreur s\'est produite: ' + error.message;
          }
          
          errorMessage.textContent = errorMsg;
          errorMessage.style.display = 'block';
        })
        .finally(() => {
          // R√©activer le bouton
          submitBtn.disabled = false;
          submitBtn.textContent = 'Envoyer le lien de r√©initialisation';
        });
    });
    
    // Permettre de fermer les messages en cliquant dessus
    document.getElementById('success-message').addEventListener('click', function() {
      this.style.display = 'none';
    });
    
    document.getElementById('error-message').addEventListener('click', function() {
      this.style.display = 'none';
    });
  </script>
</body>
</html>