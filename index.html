<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SkiTrack - Mont Orford</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* Cacher le contenu principal par défaut */
    #main-content {
      display: none;
    }
    
    /* Style pour l'indicateur de chargement */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 1.2rem;
      color: #6b7280;
    }
    
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #1a56db;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">SkiTrack - Mont Orford</div>
      <div class="nav-links">
        <a href="index.html" class="active">Tableau de bord</a>
        <a href="pages/trail-inspection.html">Inspection piste</a>
        <a href="pages/shelter-inspection.html">Inspection abri</a>
        <a href="pages/inspection-history.html">Historique</a>
        <a href="#" id="login-link">Connexion</a>
      </div>
    </nav>
  </header>
  
  <!-- Indicateur de chargement -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <span>Vérification de l'authentification...</span>
  </div>
  
  <!-- Contenu principal (caché initialement) -->
  <div id="main-content">
    <main>
      <div class="dashboard-header">
        <h1>Tableau de bord des inspections</h1>
        <div class="user-info">
          <span id="user-name">Chargement...</span>
        </div>
      </div>
      
      <div class="status-cards">
        <div class="card">
          <div class="card-title">Pistes inspectées aujourd'hui</div>
          <div class="card-value">6/11</div>
        </div>
        <div class="card">
          <div class="card-title">État général du domaine</div>
          <div class="card-value">Bon</div>
        </div>
        <div class="card">
          <div class="card-title">Problèmes signalés</div>
          <div class="card-value">4</div>
        </div>
        <div class="card">
          <div class="card-title">Dernière mise à jour</div>
          <div class="card-value">14 avril, 10:45</div>
        </div>
      </div>
      
      <!-- Votre carte et autres éléments du tableau de bord ici -->
      <div class="map-container">
        <!-- Contenu de la carte ici -->
      </div>
      
      <div class="recent-inspections">
        <h2>Inspections récentes</h2>
        <!-- Table des inspections récentes ici -->
      </div>
    </main>
  </div>

  <!-- Scripts Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "VOTRE_API_KEY",
      authDomain: "votre-projet.firebaseapp.com",
      projectId: "votre-projet",
      storageBucket: "votre-projet.appspot.com",
      messagingSenderId: "VOTRE_MESSAGING_ID",
      appId: "VOTRE_APP_ID"
    };
    
    // Initialisation de Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Référence à l'auth et Firestore
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Gestion de l'authentification
    function checkAuthStatus() {
      const loading = document.getElementById('loading');
      const mainContent = document.getElementById('main-content');
      const loginLink = document.getElementById('login-link');
      const userName = document.getElementById('user-name');
      
      auth.onAuthStateChanged(function(user) {
        if (user) {
          // L'utilisateur est connecté
          console.log("Utilisateur connecté:", user.email);
          
          // Mettre à jour l'interface
          loginLink.textContent = 'Déconnexion';
          loginLink.onclick = function(e) {
            e.preventDefault();
            auth.signOut().then(() => {
              window.location.reload();
            });
          };
          
          // Afficher le nom de l'utilisateur
          if (user.displayName) {
            userName.textContent = user.displayName;
          } else {
            db.collection('inspectors').where('email', '==', user.email).get()
              .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                  const inspectorData = querySnapshot.docs[0].data();
                  userName.textContent = inspectorData.name || user.email;
                } else {
                  userName.textContent = user.email;
                }
              })
              .catch((error) => {
                console.error("Erreur lors de la récupération des données:", error);
                userName.textContent = user.email;
              });
          }
          
          // Charger les données du tableau de bord
          loadDashboardData();
          
          // Afficher le contenu principal
          loading.style.display = 'none';
          mainContent.style.display = 'block';
        } else {
          // L'utilisateur n'est pas connecté, rediriger vers la page de connexion
          console.log("Aucun utilisateur connecté");
          window.location.href = 'pages/login.html';
        }
      });
    }
    
    // Fonction pour charger les données du tableau de bord
    function loadDashboardData() {
      // Logique pour charger les données depuis Firestore
      // Cette fonction serait développée pour récupérer les dernières inspections,
      // calculer les statistiques, etc.
      console.log("Chargement des données du tableau de bord...");
      
      // Exemple: récupérer les inspections récentes
      db.collection('trail_inspections')
        .orderBy('date', 'desc')
        .limit(5)
        .get()
        .then((querySnapshot) => {
          // Traiter les résultats
          console.log("Inspections récentes récupérées");
        })
        .catch((error) => {
          console.error("Erreur lors de la récupération des inspections:", error);
        });
        
      // Dans une implémentation réelle, vous mettriez à jour les cartes de statut,
      // la carte, et le tableau des inspections récentes avec les données de Firestore
    }
    
    // Vérifier l'authentification au chargement de la page
    document.addEventListener('DOMContentLoaded', checkAuthStatus);
  </script>
</body>
</html>